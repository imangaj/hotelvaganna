version: '3.8'

services:
  # SQLite setup - No external database service required

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: pms-backend
    ports:
      - "5000:5000"
    environment:
      # DATABASE_URL: "file:./dev.db" # Default in usage
      JWT_SECRET: "your_jwt_secret_key_here_change_in_production"
      JWT_EXPIRE: "7d"
      PORT: 5000
      NODE_ENV: production
      HOTEL_EMAIL: "hotel.valganna@libero.it"
      SMTP_HOST: "smtp.libero.it"
      SMTP_PORT: 465
      SMTP_USER: "hotel.valganna@libero.it"
      SMTP_PASS: "hotelvalganna123"
      SMTP_FROM: "hotel.valganna@libero.it"
      STRIPE_SECRET_KEY: ""
      STRIPE_SUCCESS_URL: ""
      STRIPE_CANCEL_URL: ""
    volumes:
      - ./backend/prisma:/app/prisma # Persist SQLite DB

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        VITE_APP_MODE: "guest"
        VITE_API_URL: "http://64.226.97.191:5000/api"
    container_name: pms-frontend
    ports:
      - "3000:3000"
    environment:
      VITE_APP_MODE: "guest"
      VITE_API_URL: "http://64.226.97.191:5000/api"
    depends_on:
      - backend
    # volumes removed for production; ensures latest build is served

volumes:
  postgres_data:

networks:
  default:
    name: pms-network
